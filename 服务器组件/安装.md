# 安装和运行SVMP服务器组件

[TOC]

## 概观

SVMP服务器组件由三个单独的部分组成：

1. SVMP监督器，负责处理身份验证和云服务，还包括Web控制台
2. SVMP服务器，它将消息从客户端代理到其虚拟机
3. SVMP配置工具，提供管理用户和虚拟设备的命令行界面

SVMP服务器组件可以安装在大多数Linux发行版上。它已经在Ubuntu 10.04 +，CentOS 6和RHEL 6上进行了测试。对于开发，它也可以在Nodejs支持的其他平台上安装和运行，例如OS X和Windows。有关更多选项，请参阅[SVMP监督](https://github.com/SVMP/svmp-overseer/blob/master/README.md)，[SVMP服务器](https://github.com/SVMP/svmp-server/blob/master/README.md)和[SVMP配置工具](https://github.com/SVMP/svmp-server-cli/blob/master/README.md)自述文件。

## 先决条件

- 安装[Node.js](http://nodejs.org/) 0.10.24或更新版本以及npm工具。请参阅[此处](https://github.com/joyent/node/wiki/Installing-Node.js-via-package-manager)从软件包安装。
- 安装[MongoDB](http://docs.mongodb.org/manual/installation/) 2.0或更高版本

## 监工

### 安装

1. 从节点包管理器安装先决条件：

```
 $ sudo npm install -g grunt-cli
 $ sudo npm install -g bower
```

> **可选的依赖项。**如果要对服务器启用基于PAM的用户身份验证，请安装libpam开发包。
>
> 在Debian和Ubuntu上：
>
> ```
> $ sudo apt-get install libpam-dev
> ```
>
> 在RHEL和CentOS上（需要EPEL）：
>
> ```
> $ sudo yum install pam-devel
> ```



2. 从GitHub下载代码：

```
 $ git clone https://github.com/SVMP/svmp-overseer.git
```



3. 切换到项目的根目录并安装其依赖项：

```
 $ cd svmp-overseer
 $ npm install
```

4. 从提供的模板创建配置文件

```
 $ cp config/_config.local.template.yaml config/config-local.yaml
```

5. [编辑配置](https://github.com/xusx1024/svmpdoc/blob/master/%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BB%84%E4%BB%B6/%E9%85%8D%E7%BD%AE.md)以适合您的环境。

### 运行

运行以下命令启动守护程序：

```
$ export NODE_ENV=production
$ node server.js [--config <path/to/config.yaml>]
```

有关使用[supervisord](http://supervisord.org/)将监督作为服务运行的示例，请参阅[Puppet](https://svmp.github.io/server-install.html#puppet)模块。

### 认证

为使服务器和配置工具能够与监督者通信，他们需要使用预先生成的*管理员角色* JSON Web令牌进行身份验证。您应该为每个组件生成单独的标记，并将它们存储在相应的配置文件中。要了解如何生成其中一个令牌，请使用以下命令：

```
$ node create-token.js -h
```

例：

```
$ node create-token.js -a svmp-server-1
$ node create-token.js -a svmp-config-tool-1
```

## 服务器

### 安装

1. 从GitHub下载代码：

   ```
    $ git clone https://github.com/SVMP/svmp-server.git
   ```

2. 切换到项目的根目录并安装其依赖项：

   ```
    $ cd svmp-server
    $ npm install
   ```

3. 从提供的模板创建配置文件

   ```
    $ cp config/_config.local.template.yaml config/config-local.yaml
   ```

4. [编辑配置](https://svmp.github.io/server-config.html#server)以适合您的环境。在执行此操作之前，您需要使用其证书配置监督，并且还需要为要使用的服务器生成令牌。

### 运行

启动服务器守护程序本身：

```
$ export NODE_ENV=production
$ node bin/server.js
```

有关使用[supervisord将](http://supervisord.org/) svmp-server作为服务运行的示例，请参阅[Puppet](https://svmp.github.io/server-install.html#puppet)模块。

## 配置工具

### 安装

使用npm全局安装：

```
$ npm install -g git+https://github.com/SVMP/svmp-server-cli.git
```

### 运行

```
$ export overseer_url='https://<overseer_host>:<overseer_port>'
$ export auth_token='<admin role authorization token>'
$ svmp-config -h
```

或者，在YAML文件中设置url和token，`~/.svmprc`如下所示：

```
overseer_url: '<url>'
auth_token: '<token>'
```

## Puppet

puppet模块可用于在RHEL和CentOS系统上自动安装和配置SVMP服务器。该模块可以在[puppet-svmp-server](https://github.com/SVMP/puppet-svmp-server)项目中找到。

除了安装和配置服务器之外，该模块还可以管理init脚本，Node.js和MongoDB。
